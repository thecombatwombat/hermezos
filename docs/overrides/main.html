{% extends "base.html" %}

{% block extrahead %}
  <!-- Preload fonts for better performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Meta tags for better SEO and social sharing -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="HermezOS - Messenger of Unwritten Rules">
  <meta property="og:description" content="Local-first knowledge registry that transforms your team's unwritten rules into deterministic, AI-ready context packs.">
  <meta property="og:image" content="{{ config.site_url }}assets/images/hermezos-social.png">
  <meta property="og:url" content="{{ config.site_url }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="HermezOS - Messenger of Unwritten Rules">
  <meta name="twitter:description" content="Local-first knowledge registry that transforms your team's unwritten rules into deterministic, AI-ready context packs.">
  <meta name="twitter:image" content="{{ config.site_url }}assets/images/hermezos-social.png">

  <!-- Favicon and app icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ 'assets/images/apple-touch-icon.png' | url }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ 'assets/images/favicon-32x32.png' | url }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ 'assets/images/favicon-16x16.png' | url }}">
  <link rel="manifest" href="{{ 'assets/images/site.webmanifest' | url }}">

  <!-- Custom analytics or tracking code can go here -->
{% endblock %}

{% block announce %}
  <!-- Optional announcement bar -->
  {% if config.extra.announcement %}
    <div class="md-banner md-banner--warning">
      <div class="md-banner__inner md-grid md-typeset">
        {{ config.extra.announcement }}
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block hero %}
  {% if page.meta and page.meta.hero %}
    <div class="md-hero">
      <div class="md-hero__inner md-grid">
        <div class="md-hero__content">
          <h1>{{ page.meta.hero.title | default(config.site_name, true) }}</h1>
          <p>{{ page.meta.hero.description }}</p>
          {% if page.meta.hero.cta %}
            <a href="{{ page.meta.hero.cta.link }}" class="md-button md-button--primary">
              {{ page.meta.hero.cta.text }}
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block footer %}
  <footer class="md-footer">
    {% if "navigation.footer" in config.theme.features %}
      {% if page.previous_page or page.next_page %}
        <nav class="md-footer__inner md-grid" aria-label="{{ lang.t('footer') }}">
          {% if page.previous_page %}
            <a href="{{ page.previous_page.url | url }}" class="md-footer__link md-footer__link--prev" aria-label="{{ lang.t('footer.previous') }}: {{ page.previous_page.title | e }}" rel="prev">
              <div class="md-footer__button md-icon">
                {% include ".icons/material/arrow-left.svg" %}
              </div>
              <div class="md-footer__title">
                <span class="md-footer__direction">
                  {{ lang.t("footer.previous") }}
                </span>
                <div class="md-ellipsis">
                  {{ page.previous_page.title }}
                </div>
              </div>
            </a>
          {% endif %}
          {% if page.next_page %}
            <a href="{{ page.next_page.url | url }}" class="md-footer__link md-footer__link--next" aria-label="{{ lang.t('footer.next') }}: {{ page.next_page.title | e }}" rel="next">
              <div class="md-footer__title">
                <span class="md-footer__direction">
                  {{ lang.t("footer.next") }}
                </span>
                <div class="md-ellipsis">
                  {{ page.next_page.title }}
                </div>
              </div>
              <div class="md-footer__button md-icon">
                {% include ".icons/material/arrow-right.svg" %}
              </div>
            </a>
          {% endif %}
        </nav>
      {% endif %}
    {% endif %}
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-copyright">
          {% if config.copyright %}
            <div class="md-copyright__highlight">
              {{ config.copyright }}
            </div>
          {% endif %}
          <div class="md-copyright__highlight">
            Made with ❤️ for development teams who value knowledge sharing
          </div>
        </div>
        {% if config.extra.social %}
          <div class="md-social">
            {% for social in config.extra.social %}
              <a href="{{ social.link }}" target="_blank" rel="noopener" title="{{ social.name }}" class="md-social__link">
                {% include ".icons/" ~ social.icon ~ ".svg" %}
              </a>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </footer>
{% endblock %}

{% block scripts %}
  {{ super() }}

  <!-- Custom JavaScript for enhanced interactions -->
  <script>
    // Add smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Add copy button functionality to code blocks
    document.querySelectorAll('.highlight').forEach(block => {
      const button = document.createElement('button');
      button.className = 'md-clipboard md-icon';
      button.title = 'Copy to clipboard';
      button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg>';

      button.addEventListener('click', () => {
        const code = block.querySelector('code');
        if (code) {
          navigator.clipboard.writeText(code.textContent).then(() => {
            button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/></svg>';
            setTimeout(() => {
              button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg>';
            }, 2000);
          });
        }
      });

      block.style.position = 'relative';
      button.style.position = 'absolute';
      button.style.top = '1rem';
      button.style.right = '1rem';
      button.style.zIndex = '1';
      button.style.background = 'var(--md-primary-fg-color)';
      button.style.color = 'var(--md-primary-bg-color)';
      button.style.border = 'none';
      button.style.borderRadius = '0.25rem';
      button.style.padding = '0.5rem';
      button.style.cursor = 'pointer';
      button.style.opacity = '0.7';
      button.style.transition = 'opacity 0.2s ease';

      button.addEventListener('mouseenter', () => button.style.opacity = '1');
      button.addEventListener('mouseleave', () => button.style.opacity = '0.7');

      block.appendChild(button);
    });

    // Add intersection observer for fade-in animations
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, observerOptions);

    // Observe elements for animation
    document.querySelectorAll('.md-typeset h2, .md-typeset h3, .highlight, p:has(strong:first-child)').forEach(el => {
      el.style.opacity = '0';
      el.style.transform = 'translateY(20px)';
      el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      observer.observe(el);
    });
  </script>
{% endblock %}
